// ==========================================================================
// Project:   Ember Autosuggest
// Copyright: Â©2013 Paul Cowan
// License:   Licensed under MIT license (see license.js)
// ==========================================================================



 // Version: 0.0.2

!function(){{var e=Ember.get;Ember.set}Ember.Handlebars.registerBoundHelper("displayHelper",function(t){return new Handlebars.SafeString(e(this,t))})}(),function(){var e=Ember.Handlebars.compile;Ember.TEMPLATES["components/auto-suggest"]=e('<ul class=\'selections\'>{{#each destination}}  <li class="selection">    <a class="as-close" {{action "removeSelection" this}}>x</a>      {{yield}}      {{displayHelper controller.searchPath}}  </li>{{/each}}'+"<li>{{view view.autosuggest value=query moveSelection='moveSelection' selectActive='selectActive' hideResults='hideResults' class='autosuggest'}}</li></ul><div {{bind-attr class=':results hasQuery::hdn'}}><ul class='suggestions'>{{#each displayResults}}  <li {{action \"addSelection\" this}} {{bind-attr class=\":result active\"}}>    <span class=\"result-name\">    {{yield}}    {{displayHelper controller.searchPath}}    </span>  </li>{{else}} <li class='no-results'>No Results.</li>{{/each}}</ul></div>")}(),function(){{var e=Ember.get,t=Ember.set,s=(Ember.setEach,Ember.addObserver);Ember.removeObserver}window.AutoSuggestComponent=Ember.Component.extend({actions:{addSelection:function(s){t(this,"query",""),e(this,"destination").addObject(s),t(this,"selectionIndex",-1),this.$("input[type=text]").focus()},moveSelection:function(s){var i,n=e(this,"selectionIndex"),o="up"===s,r=!o,a=e(this,"displayResults"),l=e(a,"length"),u=e(this,"searchPath");if(a.setEach("active",!1),!l)return t(this,"selectionIndex",-1),void 0;if(i=this.$("li.result.hover"),i.length){var h=Ember.$("span",i).text(),c=a.find(function(t){return e(t,u)===h});n=a.indexOf(c),this.$("ul.suggestions li").removeClass("hover"),this.$("input.autosuggest").focus()}o&&0>=n?n=0:r&&n===l-1?n=l-1:r?n++:n--;var d=e(this,"displayResults").objectAt(n);t(this,"selectionIndex",n),t(d,"active",!0)},hideResults:function(){var s=e(this,"displayResults");t(this,"selectionIndex",-1),e(s,"length")||this.$(".no-results").addClass("hdn"),this.$(".results").addClass("hdn")},selectActive:function(){var t=(e(this,"selectionIndex"),e(this,"displayResults.length"));if(t){var s=e(this,"displayResults").find(function(t){return e(t,"active")});return s?(this.send("addSelection",s),void 0):(this.send("hideResults"),void 0)}},removeSelection:function(t){e(this,"destination").removeObject(t)}},classNameBindings:[":autosuggest"],minChars:1,searchPath:"name",query:null,selectionIndex:-1,init:function(){this._super.apply(this,arguments),s(this,"query",this.queryDidChange),t(this,"displayResults",Ember.A())},didInsertElement:function(){this._super.apply(this,arguments),Ember.assert("You must supply a source for the autosuggest component",e(this,"source")),Ember.assert("You must supply a destination for the autosuggest component",e(this,"destination")),this.$("ul.suggestions").on("mouseover","li",this.mouseOver.bind(this)),this.$("ul.suggestions").on("mouseout","li",this.mouseOut.bind(this))},_queryPromise:function(t){var s=e(this,"source"),i=e(this,"searchPath"),n=e(this,"store");return new Ember.RSVP.Promise(function(e,o){if("undefined"!=typeof DS&&DS.Model.detect(s)){var r={};r[i]=t;var a=s.toString().humanize();n.find(a,r).then(e,o)}else s.then?s.then(e,o):e(s)})},queryDidChange:function(){var s=e(this,"query"),i=e(this,"displayResults"),n=e(this,"hasQuery"),o=this;return n?(this._queryPromise(s).then(function(e){o.processResults(s,e)},function(e){throw console.log(e.message),console.log(e.stack),e}),void 0):(t(this,"selectionIndex",-1),i.clear(),void 0)},processResults:function(t,s){var i=this,n=e(this,"displayResults"),o=s.filter(function(s){return-1!==s.get(e(i,"searchPath")).toLowerCase().search(t.toLowerCase())}).filter(function(t){return!e(i,"destination").contains(t)});if(0===e(o,"length"))return n.clear();this.positionResults();var r=e(this,"searchPath");n.clear(),n.pushObjects(Ember.A(o.sort(function(t,s){return Ember.compare(e(t,r),e(s,r))})))},hasQuery:Ember.computed(function(){var t=e(this,"query");return t&&t.length>e(this,"minChars")?(this.positionResults(),!0):!1}).property("query"),mouseOver:function(s){var i=this.$(s.target),n=e(this,"displayResults").filter(function(t){return e(t,"active")});(n||n.length)&&(n.setEach("active",!1),t(this,"selectionIndex",-1)),i.hasClass("result-name")||(this.$("ul.suggestions li").removeClass("hover"),i.addClass("hover"))},mouseOut:function(e){var t=$(e.target);t.parents("ul").hasClass("suggestions")||this.$("ul.suggestions li").removeClass("hover")},positionResults:function(){var e=this.$(".results"),t=(this.$("input.autosuggest"),this.$("ul.suggestions")),s=(this.$("ul.selections"),this.$()),i=s.position();e.removeClass("hdn"),t.css("position","absolute"),t.css("left",i.left),t.css("top",i.top+this.$().height());var n=s.outerWidth();t.css("width",n)},autosuggest:Ember.TextField.extend({KEY_DOWN:40,KEY_UP:38,COMMA:188,TAB:9,ENTER:13,ESCAPE:27,init:function(){this._super.apply(this,arguments);var e=Ember.A([this.KEY_UP,this.KEY_DOWN,this.COMMA,this.TAB,this.ENTER,this.ESCAPE]);this.set("allowedKeyCodes",e)},keyDown:function(t){var s=t.keyCode;if(this.get("allowedKeyCodes").contains(s)){var i=e(this,"controller");switch(s){case this.KEY_UP:this.sendAction("moveSelection","up");break;case this.KEY_DOWN:this.sendAction("moveSelection","down");break;case this.ENTER:i.sendAction("selectActive");break;case this.ESCAPE:this.sendAction("hideResults");break;default:console.log(s)}}},focusOut:function(){var e=this;setTimeout(function(){e.sendAction("hideResults")},200)}}),_yield:function(e,t){var s=Ember.get,i=t.data.view,n=this._parentView,o=s(this,"template");o&&(Ember.assert("A Component must have a parent view in order to yield.",n),i.appendChild(Ember.View,{isVirtual:!0,tagName:"",_contextView:n,template:o,context:s(i,"context"),controller:s(i,"controller"),templateData:{keywords:n.cloneKeywords()}}))}})}(),function(){String.prototype.humanize=function(){var e;return e=this.replace(/_id$/,"").replace(/_/g," ").replace(/([a-z\d]*)/gi,function(e){return e.toLowerCase()}),e.split(".").pop()},Ember.onLoad("Ember.Application",function(e){e.initializer({name:"injectStoreIntoAutosuggest",after:"store",initialize:function(e){window.AutoSuggestComponent.reopen({store:e.lookup("store:main")})}})})}(),"undefined"==typeof location||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname||Ember.Logger.warn("You are running a production build of Ember on localhost and won't receive detailed error messages. If you want full error messages please use the non-minified build provided on the Ember website.");